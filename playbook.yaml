- hosts: all
  become: true

  pre_tasks:

    - name: test connectivity
      tags: always
      ping:

    - name: Update index repository
      tags: always
      apt:
        update_cache: yes
      when: ansible_distribution in ["Ubuntu", "Debian"] 


- hosts: all
  become: true

  tasks:

    - name: Install apache2 package
      tags: apache2, ubuntu, apache
      apt:
        name: apache2
        state: latest
      when: ansible_distribution == "Ubuntu"


    - name: Add php support for apache2
      tags: apache2, ubuntu, apache
      apt:
        name: libapache2-mod-php
        state: latest
      when: ansible_distribution == "Ubuntu"

    - name: Copy default html file to ubuntu vm
      tags: ubuntu, copy, html, apache
      copy:
        src: default_site.html
        dest: /var/www/html/index.html
        owner: root
        group: root
        mode: 0644


    - name: Install unzip
      apt: 
        name: unzip 
        state: present

    - name: Install terraform
      ansible.builtin.unarchive:
        src: https://releases.hashicorp.com/terraform/1.6.6/terraform_1.6.6_linux_amd64.zip
        dest: /usr/local/bin
        remote_src: yes

    